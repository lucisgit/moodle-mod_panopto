/**
 * Polls a web service to obtain a Panopto auth url and redirect the user,
 * and displays a modal with a progress bar while the user is waiting.
 *
 * See templates:   mod_panopto/progress
 *
 * @module      mod_panopto/getauth
 * @class       getauth
 * @copyright   2020 Tony Butler <a.butler4@lancaster.ac.uk>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_panopto/getauth",["jquery","core/ajax","core/notification","core/str","core/templates","core/modal_factory"],(function($,ajax,notification,str,templates,ModalFactory){function getAuthUrl(contextId,panoptoId){ajax.call([{methodname:"mod_panopto_get_auth",args:{contextid:contextId,panoptoid:panoptoId}}])[0].done((function(authUrl){authUrl&&($("#panopto_progress_bar").val(100),window.location.replace(authUrl)),setTimeout((function(){getAuthUrl(contextId,panoptoId)}),1e3)})).fail((function(exception){str.get_string(exception.errorcode,"mod_panopto").done((function(message){$("#panopto_progress").replaceWith(message),$(".mod_panopto_progress").addClass("alert-warning p-2")})).fail(notification.exception)}))}return{init:function(contextId,panoptoId){getAuthUrl(contextId,panoptoId);var context={id:"panopto_progress",width:350},trigger=$("#panopto_info");str.get_string("preparing","mod_panopto").done((function(title){ModalFactory.create({title:title,body:templates.render("mod_panopto/progress",context,""),type:ModalFactory.types.DEFAULT,large:!1},trigger).done((function(modal){modal.getRoot().find(".modal-dialog").css({width:"400px","margin-top":"20rem"}),trigger.trigger("click")})).fail(notification.exception)})).fail(notification.exception)}}}));

//# sourceMappingURL=getauth.min.js.map